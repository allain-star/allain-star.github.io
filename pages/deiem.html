<!DOCTYPE html>
<html>
<head>
      <title>DEIEM</title>
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <link rel="stylesheet" type="text/css" href="../css/programs.css">
      <link rel="stylesheet" type="text/css" href="../css/layout.css">
      <script type="text/javascript" src="../js/responsiveness.js"></script>
      <link rel="preconnect" href="https://fonts.gstatic.com">
      <link href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro:wght@300;400&display=swap" rel="stylesheet">
<style>
table {
  border-collapse: collapse;
  border-spacing: 0;
  width: 100%;
  border: none;
}

th, td {
  text-align: left;
  padding: 8px;
}

tr:nth-child(even){background-color: #f2f2f2}
</style>

<script src="https://www.gstatic.com/firebasejs/8.1.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.1.1/firebase-database.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.1.1/firebase-storage.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.1.1/firebase-analytics.js"></script>
</head>

<body onload="loadData()">
  <header style="border-bottom: 1px solid whitesmoke; font-size: 2.5vh; padding: 20px; font-family: 'Source Sans Pro', sans-serif; font-weight: bold;"><a href="../index.html">Programs |</a> Doctor of Education in Industrial Education Management <span style="float: right;"><button style="outline: none; background: none; border: none;" onclick="openModal('courseModal')"><span style="font-size: 14px; color:white; outline: none;"><img src='../css/icons/add.png' height="15px" style="cursor: pointer; outline: none;"></span></a></header>
  <main>
    <div class="courseIntro">
      
      <div style="width: 100%;">An individual who completes a doctoral degree in education is able to demonstrate: <br> 
          <p style="margin-left: 20px;">a. a comprehensive and in-depth understanding of a complex and coherent body of knowledge (eg., theories, principles, concepts) and skills (e.g., problem-solving and communication skills) that are in the forefront of an academic discipline or professional area.
          <br>b. the ability to extend the latter or generate new knowledge through research; and<br>
          c. the ability to make informed judgements on complex issues in specific fields of specialization, and of approaching and solving problems in innovative ways  
          </p>
      </div>
        
    </div>
    <div style="overflow-x:auto; font-family: 'Source Sans Pro', sans-serif;">
      <table style=" font-size: 12px;">
        <tr style="text-align: left;">
          <th id="CC">Course Code</th>
          <th>Title</th>
          <th id="description">Description</th>
          <th id="unit">Units</th>
          <th style="width: 50px;"></th>
        </tr>
        <tbody id="dataTable" style="text-align: left;">
          
        </tbody>
      </table>
    </div>
  </main>
  
  <div id="courseModal" class="insertCourseModal">
    <input type="text" id="numCode" hidden>
    <br><input type="text" placeholder="Course Code" id="courseCode" style="width: 20%;" required> 
    <input type="text" placeholder="Course Title" id="courseTitle" style="width: 67%;" required><br> 
    <textarea rows="4" cols="50" style="width: 93%; text-align: left;" id="courseDescription" placeholder="Course Desciption" required></textarea><br>
    <input type="text" placeholder="Units" id="numberUnits" required> 
    <input type="file" style="border: none;" id="fileUploader" required>
    <br><button class="majorButtons" id="submit" style="width: 49%; padding: 8px;">Submit</button>
    <button style="width: 49%; padding: 8px; border: none;" onclick="closeModal('courseModal')" id="closeButton">Cancel</button>
  </div>

<script>
          
  var firebaseConfig = {
    apiKey: "AIzaSyDGD1OvJtu3Z0sWCvGz_MW8I8xbNRjxq84",
    authDomain: "weconnectmoto.firebaseapp.com",
    databaseURL: "https://weconnectmoto.firebaseio.com",
    projectId: "weconnectmoto",
    storageBucket: "weconnectmoto.appspot.com",
    messagingSenderId: "785399505200",
    appId: "1:785399505200:web:af31d23588f6ebeaaae8f5",
    measurementId: "G-RGXEL9WZ0P"
  };
  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  
  function loadData(){
    
    var i = 0;
    firebase.database().ref("deiem").on('value', function (snapshot){
      
      snapshot.forEach(element => {
    
        var content = '';
        var _code = element.val().code;
        var _title = element.val().title;
        var _description = element.val().description;
        var _unit = element.val().unit;
        var refCode = element.val().id;
        var pdf = element.val().pdf;
        
        if( i%2 == 0)
          content += '<tr style="background-color: #f2f2f2; padding: 8px; text-align: left;"><td><button onclick="openPdf('+refCode+')" style="background: none; border: none; cursor: pointer; text-align: left; font-family: "Source Sans Pro", sans-serif; outline: none;">'+_code+'</button></td><td style="font-family: "Source Sans Pro", sans-serif;">'+_title+'</td><td style="font-family: "Source Sans Pro", sans-serif;">'+_description+'</td><td style="text-align: center; font-family: "Source Sans Pro", sans-serif;">'+_unit+'</td><td><button style="outine: none; border: none; cursor: pointer;background: none; font-family: "Source Sans Pro", sans-serif;" onclick="deleteData('+refCode+')"><img src="../css/icons/remove.png" height="19px"></button></td></tr>';
        else
          content += "<tr style='padding: 8px; background: none; padding: 8px;'><td><button onclick='openPdf("+refCode+")' style='background: none; border: none; cursor: pointer; text-align: left; outline: none; font-family: 'Source Sans Pro', sans-serif;'>"+_code+"</button></td><td>"+_title+"</td><td style=''>"+_description+"</td><td style='text-align: center; '>"+_unit+"</td><td style='width: 20px; text-align: center;'><button style='background: none; outline: none; border: none;cursor: pointer;' onclick='deleteData("+refCode+")'><img src='../css/icons/remove.png' height='19px'></button></td></tr>"; 
        document.getElementById('dataTable').innerHTML += content;
        i++;
      });
          
    });
    
  }
  
  
  var selectedFile;
          const file = document.getElementById('fileUploader');
          file.addEventListener('change', function(e){
            selectedFile = event.target.files[0];
            var storageRef = firebase.storage().ref('/files/');
            console.log(selectedFile);
            
          });
  
  const submitBtn = document.getElementById('submit');        
          submitBtn.addEventListener('click', function(){
            
            //COURSE CONTENT
            var id = document.getElementById('numCode').value;        
            var Code = document.getElementById('courseCode').value;
            var Title = document.getElementById('courseTitle').value;
            var Description = document.getElementById('courseDescription').value;
            var NumberUnits = document.getElementById('numberUnits').value;    
  
            //FILE UPLOAD
            var filename = selectedFile.name;
            var storageRef = firebase.storage().ref(+id+'/'+filename);
            var uploadTask = storageRef.put(selectedFile);
            
            uploadTask.on('state_changed', function(snapshot){
            // Observe state change events such as progress, pause, and resume
            // Get task progress, including the number of bytes uploaded and the total number of bytes to be uploaded
            var progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
              console.log('Upload is ' + progress + '% done');
              switch (snapshot.state) {
                case firebase.storage.TaskState.PAUSED: // or 'paused'
                  console.log('Upload is paused');
                  break;
                case firebase.storage.TaskState.RUNNING: // or 'running'
                  console.log('Upload is running');
                  break;
              }
              
              if(progress == 100){
                alert("Upload Complete");
                document.getElementById('courseModal').style.display = "none";
               
              }
            }, function(error) {
              // Handle unsuccessful uploads
            }, function() {
              // Handle successful uploads on complete
              // For instance, get the download URL: https://firebasestorage.googleapis.com/...
              uploadTask.snapshot.ref.getDownloadURL().then(function(downloadURL) {
                console.log('File available at', downloadURL);
                //UPLOAD THE ACTUAL CONTENT
                firebase.database().ref("deiem/"+id).set({
                      id: id,
                      code: Code,
                      title: Title,
                      description: Description,
                      unit: NumberUnits,
                      pdf: downloadURL,
                      file: filename
                });
                
                location.reload();    
                loadData();
                
                
              });
              
            });
            
            
            
           
          });
            
        
          function deleteData(idd){
            
            var storageRef = firebase.storage().ref();

            // Points to 'images'
            
            firebase.database().ref("deiem/"+idd).on('value', function (snapshot){
              
              console.log(idd+'/'+snapshot.val().file);
              fileId = snapshot.val().file;
              
            });
            
              firebase.database().ref("deiem/"+idd).remove();;
              var spaceRef = storageRef.child(idd+'/'+fileId);

              spaceRef.delete().then(function() {
                
                   
              }).catch(function(error) {

              });
              alert('Remove row');
              location.reload(); 
                  
          }
          
          function openPdf(id){
            
            
            console.log(id);
            
            
            firebase.database().ref("deiem/"+id).on('value', function (snapshot){
              
              window.open(snapshot.val().pdf);
              
            });
            
          }
</script>


</body>
</html>
